<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Food Express</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .snap-x::-webkit-scrollbar { display: none; }
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: none; align-items: center; justify-content: center; z-index: 50; }
  </style>

  <!-- Firebase SDKs (v11) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getAuth, onAuthStateChanged, createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, signOut 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { 
      getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // TODO: paste your config here
    const firebaseConfig = {
   apiKey: "AIzaSyCAGirQsFfQNInhUc9yuMD-QElaDnmRbKE",
   authDomain: "foodexpress-9b0ff.firebaseapp.com",
   projectId: "foodexpress-9b0ff",
   storageBucket: "foodexpress-9b0ff.firebasestorage.app",
   messagingSenderId: "818281594225",
   appId: "1:818281594225:web:205774c2914ae2b9b08ad0"
    };

    // init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // expose for inline handlers
    window.__fe = { auth, db, 
      onAuthStateChanged, createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, signOut, doc, getDoc, setDoc, updateDoc, onSnapshot };
  </script>
</head>
<body class="bg-white font-sans">

  <!-- Top Bar -->
  <div class="flex justify-between items-center px-4 pt-4">
    <div class="text-sm text-gray-700" id="location">üìç Welcome to Food Express</div>
    <div class="text-2xl">üîî</div>
  </div>

  <!-- Search Bar -->
  <div class="flex items-center space-x-2 px-4 py-2">
    <div class="text-xl">üîç</div>
    <input type="text" placeholder="Search Food Express" class="flex-1 p-2 rounded-lg bg-gray-100" />
    <div class="text-xl">üé§</div>
  </div>

  <!-- Promo Banners -->
  <div class="overflow-x-auto px-4 snap-x snap-mandatory scroll-smooth">
    <div class="flex space-x-3 mt-2 w-max">
      <img src="https://i.postimg.cc/1tyQKPD9/promo.jpg" class="h-[180px] w-[320px] rounded-lg" />
      <img src="https://i.imgur.com/MH2a8rD.jpg" class="h-[180px] w-[320px] rounded-lg" />
      <img src="https://i.imgur.com/q8Aaw0m.jpg" class="h-[180px] w-[320px] rounded-lg" />
    </div>
  </div>

  <!-- Categories -->
  <div class="flex overflow-x-auto space-x-3 p-4">
    <div class="bg-orange-200 rounded-full px-4 py-2">üçî Burger</div>
    <div class="bg-orange-200 rounded-full px-4 py-2">üçï Pizza</div>
    <div class="bg-orange-200 rounded-full px-4 py-2">ü•ó Salad</div>
    <div class="bg-orange-200 rounded-full px-4 py-2">üç£ Sushi</div>
    <div class="bg-orange-200 rounded-full px-4 py-2">üåÆ Tacos</div>
  </div>

  <!-- Top Picks -->
  <div class="px-4">
    <h2 class="text-lg font-bold mb-2">Top picks</h2>
    <div class="flex overflow-x-auto space-x-4 pb-24">
      <div class="w-64 bg-white shadow rounded-xl p-3 flex-shrink-0">
        <img src="https://i.imgur.com/0y8Ftya.jpg" class="w-full h-32 object-cover rounded-lg" />
        <h3 class="mt-2 font-bold">Cheese Burger</h3>
        <p class="text-gray-500 text-sm">Burger Haven ‚Ä¢ 31 min ‚Ä¢ 4.8‚òÖ</p>
        <p class="text-orange-600 font-bold mt-1">$8.99</p>
        <button onclick="addToCart('Cheese Burger', 8.99)" class="bg-orange-500 text-white rounded-full w-full py-1 mt-2">Add to Cart</button>
      </div>

      <div class="w-64 bg-white shadow rounded-xl p-3 flex-shrink-0">
        <img src="https://i.imgur.com/nQF2zWb.jpg" class="w-full h-32 object-cover rounded-lg" />
        <h3 class="mt-2 font-bold">BBQ Bacon Burger</h3>
        <p class="text-gray-500 text-sm">Burger Haven ‚Ä¢ 27 min ‚Ä¢ 4.6‚òÖ</p>
        <p class="text-orange-600 font-bold mt-1">$9.49</p>
        <button onclick="addToCart('BBQ Bacon Burger', 9.49)" class="bg-orange-500 text-white rounded-full w-full py-1 mt-2">Add to Cart</button>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="fixed bottom-0 left-0 right-0 bg-white shadow-t p-2 flex justify-around items-center border-t">
    <div class="text-center text-orange-500">üè†<br><span class="text-xs">Home</span></div>
    <div class="text-center">üì¶<br><span class="text-xs">Orders</span></div>
    <div class="text-center relative cursor-pointer" onclick="goToCart()">
      üõí
      <span class="absolute -top-1 -right-2 bg-red-500 text-white rounded-full text-xs px-1" id="cartCount">0</span>
      <br><span class="text-xs">Cart</span>
    </div>
    <div class="text-center cursor-pointer" onclick="openLoginPopup()">üë§<br><span class="text-xs" id="accountLabel">Account</span></div>
  </div>

  <!-- Login/Signup Popup -->
  <div id="loginPopup" class="overlay">
    <div class="bg-white p-6 rounded-lg w-80">
      <h2 class="text-lg font-bold mb-4" id="popupTitle">Login</h2>
      <input type="text" id="nameField" placeholder="Name" class="border p-2 w-full mb-2 hidden" />
      <input type="email" id="emailField" placeholder="Email" class="border p-2 w-full mb-2" />
      
      <div class="relative mb-2">
        <input type="password" id="passwordField" placeholder="Password" class="border p-2 w-full" />
        <button type="button" onclick="togglePassword('passwordField', this)" class="absolute right-2 top-2 text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        </button>
      </div>

      <div class="relative mb-4 hidden" id="confirmPasswordContainer">
        <input type="password" id="confirmPasswordField" placeholder="Confirm Password" class="border p-2 w-full" />
        <button type="button" onclick="togglePassword('confirmPasswordField', this)" class="absolute right-2 top-2 text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        </button>
      </div>

      <p id="errorText" class="text-red-500 text-sm mb-2 hidden"></p>

      <button onclick="submitAuth()" class="bg-orange-500 text-white py-2 px-4 w-full rounded">Submit</button>
      <p class="text-center text-sm mt-3 cursor-pointer text-blue-500" onclick="toggleAuthMode()" id="toggleText">Create account</p>
      <p class="text-center text-sm mt-3 cursor-pointer text-gray-500" onclick="closeLoginPopup()">Cancel</p>
    </div>
  </div>

  <script>
    // UI state
    let authMode = "login";
    let cart = [];

    function openLoginPopup() {
      const { auth } = window.__fe;
      if (auth.currentUser) {
        // go to account page if you have one
        window.location.href = "account.html";
      } else {
        document.getElementById("loginPopup").style.display = "flex";
      }
    }
    function closeLoginPopup(){ document.getElementById("loginPopup").style.display = "none"; }
    function toggleAuthMode() {
      authMode = authMode === "login" ? "signup" : "login";
      document.getElementById("popupTitle").innerText = authMode === "login" ? "Login" : "Signup";
      document.getElementById("toggleText").innerText = authMode === "login" ? "Create account" : "Already have an account?";
      document.getElementById("nameField").classList.toggle("hidden", authMode === "login");
      document.getElementById("confirmPasswordContainer").classList.toggle("hidden", authMode === "login");
      document.getElementById("errorText").classList.add("hidden");
    }
    function togglePassword(id, btn) {
      const field = document.getElementById(id);
      const eye = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>`;
      const eyeOff = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a10.05 10.05 0 011.663-3.043m3.238-2.724A9.978 9.978 0 0112 5c4.477 0 8.268 2.943 9.542 7a9.978 9.978 0 01-4.252 5.053M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18"/></svg>`;
      field.type = "text"; btn.innerHTML = eyeOff;
      setTimeout(()=>{ field.type="password"; btn.innerHTML=eye; }, 2000);
    }

    async function submitAuth() {
      const { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, doc, setDoc, getDoc } = window.__fe;
      const email = document.getElementById("emailField").value.trim();
      const password = document.getElementById("passwordField").value;
      const errorText = document.getElementById("errorText");

      errorText.classList.add("hidden"); errorText.innerText = "";

      if (authMode === "signup") {
        const name = document.getElementById("nameField").value.trim();
        const confirmPassword = document.getElementById("confirmPasswordField").value;

        if (!name || !email || !password || !confirmPassword) return showErr("All fields are required");
        if (password.length < 6) return showErr("Password must be at least 6 characters");
        if (password !== confirmPassword) return showErr("Passwords do not match");

        try {
          const cred = await createUserWithEmailAndPassword(auth, email, password);
          await setDoc(doc(db, "users", cred.user.uid), { name, email, cart: [] });
          alert("Account created, please login");
          toggleAuthMode();
        } catch (e) { showErr(cleanFirebaseMsg(e.message)); }

      } else {
        try {
          const cred = await signInWithEmailAndPassword(auth, email, password);
          const uid = cred.user.uid;
          const snap = await getDoc(doc(db, "users", uid));
          const profile = snap.exists() ? snap.data() : { name: "User", cart: [] };
          document.getElementById("accountLabel").innerText = profile.name || "Account";
          cart = profile.cart || [];
          updateCartCount();
          closeLoginPopup();
          window.location.href = "cart.html";
        } catch (e) { showErr("Invalid email or password"); }
      }

      function showErr(msg){ errorText.innerText = msg; errorText.classList.remove("hidden"); }
      function cleanFirebaseMsg(m){ return m.replace("Firebase:", "").trim(); }
    }

    async function saveUserCart() {
      const { auth, db, doc, updateDoc, setDoc, getDoc } = window.__fe;
      const user = auth.currentUser;
      if (!user) return;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        await updateDoc(ref, { cart });
      } else {
        await setDoc(ref, { cart });
      }
    }

    function addToCart(name, price) {
      cart.push({ name, price });
      updateCartCount();
      saveUserCart();
    }
    function updateCartCount(){ document.getElementById("cartCount").innerText = cart.length; }
    function goToCart(){
      const { auth } = window.__fe;
      if (!auth.currentUser) openLoginPopup(); else window.location.href = "cart.html";
    }

    // auth state ‚Üí keep UI in sync + live cart
    window.addEventListener("load", () => {
      const { auth, onAuthStateChanged, db, doc, onSnapshot } = window.__fe;
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          document.getElementById("accountLabel").innerText = "Account";
          cart = []; updateCartCount();
          return;
        }
        // live subscribe to profile to reflect cart changes across tabs/devices
        const ref = doc(db, "users", user.uid);
        onSnapshot(ref, (snap) => {
          const data = snap.data() || {};
          document.getElementById("accountLabel").innerText = data.name || "Account";
          cart = data.cart || [];
          updateCartCount();
        });
      });
    });

    // expose handlers for inline HTML
    window.submitAuth = submitAuth;
    window.addToCart = addToCart;
    window.goToCart = goToCart;
    window.openLoginPopup = openLoginPopup;
    window.closeLoginPopup = closeLoginPopup;
    window.toggleAuthMode = toggleAuthMode;
    window.togglePassword = togglePassword;
  </script>
</body>
</html>
