<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Select Location</title>
  <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Inter, sans-serif;
      background: #fff;
    }

    /* Bottom Sheet Container */
    .sheet {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      border-radius: 20px 20px 0 0;
      transform: translateY(100%);
      transition: transform 0.32s cubic-bezier(.25,.1,.25,1);
      display: flex;
      flex-direction: column;
    }

    .sheet.show {
      transform: translateY(0);
    }

    /* Header Bar */
    .sheet-header {
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 17px;
      font-weight: 600;
      border-bottom: 1px solid #eee;
    }

    /* Back Icon */
    .back-icon {
      width: 26px;
      height: 26px;
      cursor: pointer;
    }

    .search-box {
  width: 92%;
  margin-left: 4%;
  padding: 15px;
  border-radius: 12px;
  border: 1px solid #ddd;
  font-size: 16px;
  background: #f2f2f7;
  outline: none;
  margin-top: 10px;
}



    .search-box:focus {
      outline: 2px solid #ff6600;
    }
    
    /* --- Success UI Upgrade --- */
#successBox {
  animation: fadeIn 0.4s ease-out;
}
    @keyframes fadeIn {
  from { opacity:0; transform: translateY(10px); }
  to { opacity:1; transform: translateY(0); }
}

    /* List Section */
    .section-title {
      margin: 20px 16px 8px;
      font-size: 14px;
      font-weight: 600;
      color: #777;
    }

    .location-item {
      padding: 16px;
      border-bottom: 1px solid #eee;
      font-size: 16px;
      cursor: pointer;
    }

    .location-item:hover {
      background: #fafafa;
    }

    .top-current-loc {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 15px;
}

.detect-btn {
  width: 92%;
  background: #eef6ff;
  color: #0284ff;
  border: none;
  padding: 14px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 16px;
  font-weight: 600;
  justify-content: center;
  cursor: pointer;
}

.detect-btn .loc-icon {
  width: 22px;
  height: 22px;
}

.or-line {
  width: 92%;
  display: flex;
  align-items: center;
  margin: 18px 0;
  text-transform: uppercase;
  color: #999;
  font-size: 12px;
  font-weight: 600;
}

.or-line::before,
.or-line::after {
  content: "";
  flex: 1;
  height: 1px;
  background: #ddd;
}

.or-line span {
  margin: 0 10px;
}


/* SHIMMER ANIMATION */
.shimmer {
  position: relative;
  overflow: hidden;
}

.shimmer div {
  background: #cfe2ff;
  border-radius: 6px;
}

.detect-btn.shimmer {
  position: relative;
}

@keyframes shimmerMove {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

/* During detecting */
.detect-btn.loading {
  background: #dbeaff;
  color: transparent !important;
  pointer-events: none;
  position: relative;
}


.detect-btn.loading .loc-icon {
  opacity: 0;
}

.detect-btn div {
  display: flex;
  align-items: center;
  justify-content: center;
}
.detect-btn:active {
  transform: scale(0.97);
}

.search-wrapper {
  width: 92%;
  margin-left: 4%;
  margin-top: 10px;
  position: relative;
}

.search-wrapper.shimmer::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  border-radius: 12px;
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,0.6) 50%,
    rgba(255,255,255,0) 100%
  );
  animation: shimmerMove 1.4s infinite;
}

/* --- Toast Upgrade --- */
.toast {
  padding: 14px 26px;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(5px);
  font-size: 15px;
}
/* Trigger shimmer on focus */
.search-box:focus + .shimmer-layer,
.search-wrapper.active::after {
  display: block;
}


  </style>

</head>
<body>


<script>
const locationDB = [
  { name: "Koodankulam", type: "area" },
  { name: "Kulasai", type: "area" },
  { name: "Eruvadi", type: "area" },
  { name: "Aralvaimozhi", type: "town" },
  { name: "Tirunelveli Junction", type: "landmark" },
  { name: "Tirunelveli Town", type: "town" },
  { name: "Vadaseri", type: "area" },
  { name: "Nagercoil", type: "city" },
  { name: "Madurai Meenakshi Temple", type: "landmark" },
  { name: "Tuticorin Airport", type: "landmark" },
  { name: "Tiruchendur Beach", type: "landmark" },
  { name: "Kanyakumari", type: "city" }
];

const trendingAreas = [
  "Tirunelveli Junction",
  "Koodankulam",
  "Nagercoil",
  "Kulasai"
];
</script>


  <!-- SWIGGY-STYLE BOTTOM SHEET -->
  <div id="locationSheet" class="sheet show">

    <!-- HEADER -->
    <div class="sheet-header">
  <img
  src="https://cdn-icons-png.flaticon.com/512/93/93634.png"
  class="back-icon"
  onclick="goBack()"
/>


  <span style="font-weight:600;">Select Delivery Location</span>
</div>


<!-- TOP CURRENT LOCATION BUTTON (SWIGGY STYLE) -->
<div class="top-current-loc">
  <button id="detectLocationBtn" class="detect-btn">
    <img src="https://cdn-icons-png.flaticon.com/512/535/535239.png" class="loc-icon" />
    Use Current Location
  </button>

  <div class="or-line">
    <span>OR</span>
  </div>
</div>

<!-- SEARCH BAR -->
<div class="search-wrapper">
  <input type="text" placeholder="Search for area, street..." class="search-box" id="searchInput">
  <div id="searchResults" class="search-results"></div>

</div>



    <!-- RECENT LOCATIONS -->
    <div class="section-title">RECENT LOCATIONS</div>

    <div class="location-item" onclick="selectLocation('Kulasai')">Kulasai</div>
    <div class="location-item" onclick="selectLocation('Koodankulam')">Koodankulam</div>
    <div class="location-item" onclick="selectLocation('Tirunelveli')">Tirunelveli</div>
          
  
  </div>
  <div id="lottieBox" style="display:none; text-align:center; margin-top:20px;">
    <div id="lottieAnim" style="width:120px; height:120px; margin:auto;"></div>
    <p style="font-size:14px; color:#555; margin-top:10px;">Detecting your location‚Ä¶</p>
</div>
<div id="successBox" style="display:none; text-align:center; margin-top:40px;">
  <div id="successAnim" style="width:120px; height:120px; margin:auto;"></div>
  <p style="font-size:16px; font-weight:600; color:#333; margin-top:10px;">Location Updated</p>
</div>
<!-- TRENDING SEARCHES (SWIGGY STYLE) -->
<div id="trendingBox" style="margin-top:18px;">

  <div style="margin-left:16px; font-size:14px; font-weight:600; color:#777;">
    TRENDING SEARCHES
  </div>

  <div style="
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin:12px 16px;
  ">
    <!-- Trending list auto-generated -->
     
  </div>

</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const trendingContainer =
    document.querySelector("#trendingBox div:nth-child(2)");

  trendingAreas.forEach(area => {
    const btn = document.createElement("div");
    btn.textContent = area;
    btn.style.cssText = `
      padding:6px 12px;
      background:#f2f2f7;
      border-radius:12px;
      cursor:pointer;
      font-size:14px;
    `;
    btn.onclick = () => selectLocation(area);
    trendingContainer.appendChild(btn);
  });
});
</script>


<style>
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  opacity: 0;
  pointer-events: none;
  transition: 0.3s;
}
.toast.show {
  opacity: 1;
}
.search-results {
  width: 92%;
  margin-left: 4%;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  margin-top: 8px;
  display: none;
  max-height: 260px;
  overflow-y: auto;
  position: absolute;
  z-index: 999;
}

.result-item {
  padding: 14px;
  font-size: 15px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
}

.result-item:hover {
  background: #fafafa;
}

.result-highlight {
  color: #ff6a00;
  font-weight: 700;
}

</style>

<div id="toast" class="toast"></div>

<script>
function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2000);
}
</script>


  <script>


    function goBack() {
      window.parent.postMessage("closeLocationPanel", "*");
    }

   function selectLocation(loc) {
  localStorage.setItem("userLocation", loc);

  window.parent.postMessage(
    { action: "updateTopLocation", location: loc },
    "*"
  );

  window.parent.postMessage("closeLocationPanel", "*");
}



const detectBtn = document.getElementById("detectLocationBtn");
const lottieBox = document.getElementById("lottieBox");
const successBox = document.getElementById("successBox");

let loadingAnim = lottie.loadAnimation({
    container: document.getElementById("lottieAnim"),
    renderer: "svg",
    loop: true,
    autoplay: false,
    path: "https://assets10.lottiefiles.com/packages/lf20_puciaact.json"
});

let successAnim = lottie.loadAnimation({
    container: document.getElementById("successAnim"),
    renderer: "svg",
    loop: false,
    autoplay: false,
    path: "https://assets10.lottiefiles.com/packages/lf20_qp1q7mct.json"
});

detectBtn.addEventListener("click", () => {

  detectBtn.classList.add("loading");
  detectBtn.style.display = "none";

  lottieBox.style.display = "block";
  loadingAnim.play();

  navigator.geolocation.getCurrentPosition(
    async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      let locationName = "Your Location";

      try {
        const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`;
        const res = await fetch(url, {
        headers: {
       "User-Agent": "FoodExpressApp/1.0 (contact@yourdomain.com)"
      }
        });

        const data = await res.json();

        locationName =
          data.address.suburb ||
          data.address.village ||
          data.address.town ||
          data.address.city ||
          data.address.county ||
          "Unknown Area";
      } catch (e) {
        console.log("Reverse API failed", e);
      }

      // SAVE LOCATION
      localStorage.setItem("userLocation", locationName);

      // STOP LOADING
      loadingAnim.stop();
      lottieBox.style.display = "none";

      // SHOW SUCCESS LOTTIE
      successBox.style.display = "block";
      successAnim.play();

      // TOAST
      showToast(`Location set to ${locationName}`);

      // REDIRECT FAST
      setTimeout(() => {
          // ‚úÖ RESTORE UI STATE
  successBox.style.display = "none";
  detectBtn.style.display = "flex";
  detectBtn.classList.remove("loading");
  window.parent.postMessage(
    { action: "updateTopLocation", location: locationName },
    "*"
  );
  window.parent.postMessage(
    { action: "closeLocationPanel" },
    "*"
  );
}, 1200);


    },

    () => {
      loadingAnim.stop();
      lottieBox.style.display = "none";
      detectBtn.style.display = "block";
      detectBtn.classList.remove("loading");
      showToast("Unable to fetch location");
    }
  );
});



const searchBox = document.querySelector(".search-box");

searchBox.addEventListener("focus", () => {
  // Start shimmer
  searchWrapper.classList.add("shimmer");


  // Remove shimmer after 1 second just like Swiggy
  setTimeout(() => {
    searchBox.classList.remove("shimmer");
  }, 1000);
});
const searchWrapper = document.querySelector(".search-wrapper");

searchBox.addEventListener("focus", () => {
  searchWrapper.classList.add("shimmer");

  setTimeout(() => {
    searchWrapper.classList.remove("shimmer");
  }, 1000);
});



  </script>
  
<script>
// SMART SWIGGY STYLE LIVE SEARCH
const input = document.getElementById("searchInput");
const resultsBox = document.getElementById("searchResults");

input.addEventListener("input", () => {
  const query = input.value.trim().toLowerCase();

  if (!query) {
    resultsBox.style.display = "none";
    resultsBox.innerHTML = "";
    return;
  }

  let matches = locationDB.filter(item =>
    item.name.toLowerCase().includes(query)
  );

  if (matches.length === 0) {
    resultsBox.style.display = "block";
    resultsBox.innerHTML =
      `<div class='result-item' style='color:#888;'>No areas found</div>`;
    return;
  }

  resultsBox.style.display = "block";
  resultsBox.innerHTML = matches
    .map(item => {
      let regex = new RegExp(query, "gi");
      let highlighted = item.name.replace(regex, (txt) =>
        `<span class='result-highlight'>${txt}</span>`
      );

      let tag = (item.type === "landmark")
        ? "üìç Landmark"
        : (item.type === "city")
        ? "üèô City"
        : "üìå Area";

      return `
      <div class="result-item" onclick="selectLocation('${item.name}')">
        <div style="font-weight:600">${highlighted}</div>
        <div style="font-size:12px; color:#777;">${tag}</div>
      </div>`;
    })
    .join("");
});

  

</script>




</body>
</html>
